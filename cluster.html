
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Orbat Clustering</title>
<style>
    .node-text {
      font: 12px sans-serif;
    }

    .link {
      fill: none;
      stroke: rgb(200, 200, 200);
      shape-rendering: crispEdges;
      stroke-dasharray: 2, 2;
    }

    .indicator {
      stroke: rgb(100, 100, 100);
    }
	
	h2 {
		width: 200px;
		font: 20px sans-serif;
	}
	
	table{
		width: 200px;
		font: 14px sans-serif;
	}
	
	tr:hover {background-color: #f5f5f5;}
	
	th, td {
		text-align: left;
		border-bottom: 1px solid #ddd;
	}
</style>

<style type="text/css">
	<!-- body{ -->
		<!-- font-family: Verdana, Verdana, Geneva, sans-serif; -->
		<!-- font-weight: normal; -->
		<!-- font-size: 15px; -->
		<!-- background-color: #202020; -->
		<!-- margin-top:0px; -->
		<!-- margin-left: 0px; -->
   		<!-- margin-right: 0px; -->
   		<!-- color:#f0f0f0;	 -->
	<!-- } -->

	.page{
	position: absolute; 
	left: 0px; 
	top: 0px; 
		width: 100%;
		height: 100%;
	}
		html, body {
		height: 100%;
	}
	a{
		color: rgb(140, 255, 140);
	}
			.heading{
		height: 50px;
		width: 100%;
		background-color:rgb(0,168,220);
		position: relative;	


	}
	.heading a{
		font-size: 20px;
		text-decoration: none;
    	position: relative; 
    	top: 12px;
		left: 10px;
font-family: Helvetica, arial, freesans, clean, sans-serif;
font-weight: normal;
    	color: #fff;	
	}
		.h1{
    	bottom: 0;
		left: 10px;
		font-family: Helvetica, arial, freesans, clean, sans-serif;
font-size: 30px;
font-style: normal;
font-variant: normal;
font-weight: normal;
line-height: 1.2;
    	color: rgb(0,168,220);
    	margin-top: 5px;
margin-bottom: 5px;
	}
	.h2{
font-family: Helvetica, arial, freesans, clean, sans-serif;
font-size: 23px;
font-style: normal;
font-variant: normal;
font-weight: normal;
line-height: 1.2;
    	color: rgb(0,168,220);
    	margin-top: 5px;
margin-bottom: 5px;
	}
		.h3{
font-family: Helvetica, arial, freesans, clean, sans-serif;
font-size: 20px;
font-style: normal;
font-variant: normal;
font-weight: normal;
line-height: 1.2;
    	color: rgb(0,168,220);
    	margin-top: 5px;
margin-bottom: 5px;

	}
	.logo{
    	position: absolute; 
    	bottom: 10px;
		right: 10px;    	
	}

	.mymap{
		position: absolute; 
		left: 0px; 
		top: 20px; 
		bottom: 20px; 
		right: 0px;
	}
	
	#MainSidebar{
	position: absolute; 
	width: 300px; 
	top: 50px; 
	right: 0px;
	bottom: 0px;
	background-color:#ffffff;
	border-left:3px solid #202020;
	color:#202020;
	padding:5px;
    z-index:100;
	overflow: auto;
	font-size: 12px;
	}

	#SubSidebar{
	position: absolute; 
	width: 280px;
	height: 100px; 
	bottom: 0px; 
	right: 0px;
	background-color:#ffffff;
	border-left:3px solid #202020;
	border-top:3px solid #202020;
	color:#202020;
	padding:5px;
    z-index:100;
	overflow: auto;
	font-size: 12px;
	}
.loader {
	  border: 16px solid #f3f3f3; /* Light grey */
	  border-top: 16px solid #3498db; /* Blue */
	  border-radius: 50%;
	  width: 120px;
	  height: 120px;
	  animation: spin 2s linear infinite;
	}

	@keyframes spin {
	  0% { transform: rotate(0deg); }
	  100% { transform: rotate(360deg); }
	}
</style>


<!-- <script src="dist/leaflet.js"  type="text/javascript" ></script> -->
<script  type="text/javascript" src="milsymbol.js"></script>
<script  type="text/javascript" src="orbat.js"></script>
<script  type="text/javascript" src="situation.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
<!-- <link rel="stylesheet" href="dist/leaflet.css" /> -->
 
<script src="https://d3js.org/d3.v4.min.js"></script>
 
<script  type="text/javascript" >
// orbat = {'1.ARM(UK)': {lat: 2472.0, lng: 2604.0, command: 'I.Corps(UK)', sidc: 'SFGPUCA----I', color: 'rgb(255,204,205)'}, '1.ARM(US)': {lat: 1948.0, lng: 2784.0, command: 'VII.Corps(US)', sidc: 'SFGPUCA----I', color: 'rgb(0,174,239)'}, '1.Div(BEL)': {lat: 1476.0, lng: 1676.0, command: 'I.Corps(BEL)', sidc: 'SFGPUCIZ---I', color: 'rgb(255,255,0)'}, '1.GJD': {lat: 144.0, lng: 3120.0, command: 'II.Korps', sidc: 'SFGPUCIO---I', color: 'rgb(167,169,172)'}, '1.GTA': {lat: 1672.0, lng: 3848.0, command: 'GSFG', sidc: 'SFGPUCA----J', color: 'rgb(190,30,45)'}, '1.GTAFSH': {lat: 1672.0, lng: 3888.0, command: '1.GTA', sidc: 'SFGPUSS-----', color: 'rgb(190,30,45)'}, '1.GTR': {lat: 1572.0, lng: 3520.0, command: '20.GMRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '1.MBde(BEL)': {lat: 1700.0, lng: 1512.0, command: '1.Div(BEL)', sidc: 'SFGPUCIZ---H', color: 'rgb(255,255,0)'}, '1.MSD': {lat: 2240.0, lng: 3660.0, command: 'MB.V', sidc: 'SFGPUCIZ---I', color: 'rgb(153,69,70)'}, '1.NLMD': {lat: 2096.0, lng: 1696.0, command: 'I.Corps(NL)', sidc: 'SFGPUCIZ---I', color: 'rgb(247,148,30)'}, '1.PzD': {lat: 2208.0, lng: 2784.0, command: 'I.Korps', sidc: 'SFGPUCA----I', color: 'rgb(167,169,172)'}, '1.PzGBde': {lat: 2212.0, lng: 2972.0, command: '1.PzD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '1.SC': {lat: 2084.0, lng: 2416.0, command: 'SACEUR', sidc: 'SFGPUSS-----', color: 'rgb(0,174,239)'}, '1/1.Bde(US)': {lat: 1008.0, lng: 2932.0, command: '1.ARM(US)', sidc: 'SFGPUCA----H', color: 'rgb(0,174,239)'}, '1/3.Bde(US)': {lat: 1408.0, lng: 2452.0, command: '3.ARM(US)', sidc: 'SFGPUCA----H', color: 'rgb(0,174,239)'}, '1/3I.Bde(US)': {lat: 1244.0, lng: 2884.0, command: '3.INF(US)', sidc: 'SFGPUCA----H', color: 'rgb(0,174,239)'}, '1/8.Bde(US)': {lat: 1220.0, lng: 2324.0, command: '8.INF(US)', sidc: 'SFGPUCIZ---H', color: 'rgb(0,174,239)'}, '2.ACAV(US)': {lat: 1176.0, lng: 3064.0, command: 'VII.Corps(US)', sidc: 'SFGPUCRVA--G', color: 'rgb(0,174,239)'}, '2.GTA': {lat: 2584.0, lng: 3688.0, command: 'GSFG', sidc: 'SFGPUCA----J', color: 'rgb(190,30,45)'}, '2.PzBde': {lat: 2268.0, lng: 2784.0, command: '1.PzD', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '2.PzGD': {lat: 1796.0, lng: 2684.0, command: 'III.Korps', sidc: 'SFGPUCIZ---I', color: 'rgb(167,169,172)'}, '2/1.Bde(US)': {lat: 1048.0, lng: 3096.0, command: '1.ARM(US)', sidc: 'SFGPUCA----H', color: 'rgb(0,174,239)'}, '2/3.Bde(US)': {lat: 1308.0, lng: 2596.0, command: '3.ARM(US)', sidc: 'SFGPUCIZ---H', color: 'rgb(0,174,239)'}, '2/3I.Bde(US)': {lat: 1108.0, lng: 2864.0, command: '3.INF(US)', sidc: 'SFGPUCA----H', color: 'rgb(0,174,239)'}, '2/8.Bde(US)': {lat: 1052.0, lng: 2084.0, command: '8.INF(US)', sidc: 'SFGPUCIZ---H', color: 'rgb(0,174,239)'}, '3.ARM(UK)': {lat: 1896.0, lng: 2296.0, command: 'I.Corps(UK)', sidc: 'SFGPUCA----I', color: 'rgb(255,204,205)'}, '3.ARM(US)': {lat: 1268.0, lng: 2456.0, command: 'V.Corps(US)', sidc: 'SFGPUCA----I', color: 'rgb(0,174,239)'}, '3.CAA': {lat: 2128.0, lng: 3268.0, command: 'GSFG', sidc: 'SFGPUCIZ---J', color: 'rgb(190,30,45)'}, '3.INF(US)': {lat: 1156.0, lng: 2228.0, command: 'VII.Corps(US)', sidc: 'SFGPUCIZ---I', color: 'rgb(0,174,239)'}, '3.PzBde': {lat: 2320.0, lng: 2704.0, command: '1.PzD', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '3.PzD': {lat: 2716.0, lng: 2736.0, command: 'I.Korps', sidc: 'SFGPUCA----I', color: 'rgb(167,169,172)'}, '3/1.Bde(US)': {lat: 1048.0, lng: 3096.0, command: '1.ARM(US)', sidc: 'SFGPUCIZ---H', color: 'rgb(0,174,239)'}, '3/3.Bde(US)': {lat: 516.0, lng: 3092.0, command: '3.ARM(US)', sidc: 'SFGPUCA----H', color: 'rgb(0,174,239)'}, '3/3I.Bde(US)': {lat: 1208.0, lng: 2584.0, command: '3.INF(US)', sidc: 'SFGPUCA----H', color: 'rgb(0,174,239)'}, '3/8.Bde(US)': {lat: 1004.0, lng: 2396.0, command: '8.INF(US)', sidc: 'SFGPUCA----H', color: 'rgb(0,174,239)'}, '4.AB(UK)': {lat: 2056.0, lng: 2160.0, command: '3.ARM(UK)', sidc: 'SFGPUCA----H', color: 'rgb(255,204,205)'}, '4.ARM(UK)': {lat: 2128.0, lng: 2452.0, command: 'I.Corps(UK)', sidc: 'SFGPUCA----I', color: 'rgb(255,204,205)'}, '4.IGRB': {lat: 1988.0, lng: 3436.0, command: '7.GTD', sidc: 'SFGPUCRVA--F', color: 'rgb(190,30,45)'}, '4.MBde(BEL)': {lat: 1896.0, lng: 2296.0, command: '16.Div(BEL)', sidc: 'SFGPUCIZ---H', color: 'rgb(255,255,0)'}, '4.MSD': {lat: 1644.0, lng: 3100.0, command: 'MB.III', sidc: 'SFGPUCIZ---I', color: 'rgb(153,69,70)'}, '4.NLMD': {lat: 2228.0, lng: 1612.0, command: 'I.Corps(NL)', sidc: 'SFGPUCIZ---I', color: 'rgb(247,148,30)'}, '4.PzGBde': {lat: 1888.0, lng: 2804.0, command: '2.PzGD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '4.PzGD': {lat: 800.0, lng: 3416.0, command: 'II.Korps', sidc: 'SFGPUCIZ---I', color: 'rgb(167,169,172)'}, '5.PzDv': {lat: 1380.0, lng: 2268.0, command: 'III.Korps', sidc: 'SFGPUCA----I', color: 'rgb(167,169,172)'}, '5.PzGBde': {lat: 940.0, lng: 2088.0, command: '2.PzGD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '6.AMB(UK)': {lat: 1896.0, lng: 2296.0, command: '3.ARM(UK)', sidc: 'SFGPUCIS---H', color: 'rgb(255,204,205)'}, '6.GMRD': {lat: 2364.0, lng: 3808.0, command: '20.GCAA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '6.PzBde': {lat: 1588.0, lng: 2580.0, command: '5.PzDv', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '7.AB(UK)': {lat: 2500.0, lng: 2776.0, command: '1.ARM(UK)', sidc: 'SFGPUCA----H', color: 'rgb(255,204,205)'}, '7.GTD': {lat: 2028.0, lng: 3432.0, command: '3.CAA', sidc: 'SFGPUCA----I', color: 'rgb(190,30,45)'}, '7.GTR': {lat: 1720.0, lng: 3784.0, command: '11.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '7.MBde(BEL)': {lat: 1328.0, lng: 1640.0, command: '1.Div(BEL)', sidc: 'SFGPUCIZ---H', color: 'rgb(255,255,0)'}, '7.PzD': {lat: 1672.0, lng: 3824.0, command: 'MB.III', sidc: 'SFGPUCA----I', color: 'rgb(153,69,70)'}, '7.PzDv': {lat: 2044.0, lng: 2472.0, command: 'I.Korps', sidc: 'SFGPUCA----I', color: 'rgb(167,169,172)'}, '7.PzGBde': {lat: 2768.0, lng: 2848.0, command: '3.PzD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '8.GCAA': {lat: 1632.0, lng: 3164.0, command: 'GSFG', sidc: 'SFGPUCIZ---J', color: 'rgb(190,30,45)'}, '8.INF(US)': {lat: 1156.0, lng: 2228.0, command: 'V.Corps(US)', sidc: 'SFGPUCIZ---I', color: 'rgb(0,174,239)'}, '8.MSD': {lat: 2744.0, lng: 3220.0, command: 'MB.V', sidc: 'SFGPUCIZ---I', color: 'rgb(153,69,70)'}, '8.PzBde': {lat: 2628.0, lng: 2944.0, command: '3.PzD', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '9.PzD': {lat: 2796.0, lng: 3944.0, command: 'MB.V', sidc: 'SFGPUCA----I', color: 'rgb(153,69,70)'}, '9.PzLBde': {lat: 2480.0, lng: 2856.0, command: '3.PzD', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '9.TD': {lat: 2684.0, lng: 3680.0, command: '1.GTA', sidc: 'SFGPUCA----I', color: 'rgb(190,30,45)'}, '10.GJB': {lat: 244.0, lng: 3612.0, command: '1.GJD', sidc: 'SFGPUCIO---H', color: 'rgb(167,169,172)'}, '10.GTD': {lat: 2168.0, lng: 3424.0, command: '3.CAA', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '10.PzD': {lat: 400.0, lng: 2592.0, command: 'II.Korps', sidc: 'SFGPUCA----I', color: 'rgb(167,169,172)'}, '10.PzGBde': {lat: 172.0, lng: 2172.0, command: '4.PzGD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '11.AB(UK)': {lat: 2200.0, lng: 2520.0, command: '4.ARM(UK)', sidc: 'SFGPUCA----H', color: 'rgb(255,204,205)'}, '11.ACAV(US)': {lat: 1456.0, lng: 2728.0, command: 'V.Corps(US)', sidc: 'SFGPUCRVA--G', color: 'rgb(0,174,239)'}, '11.GTD': {lat: 2684.0, lng: 3680.0, command: '1.GTA', sidc: 'SFGPUCA----I', color: 'rgb(190,30,45)'}, '11.MSD': {lat: 1860.0, lng: 3364.0, command: 'MB.III', sidc: 'SFGPUCIZ---I', color: 'rgb(153,69,70)'}, '11.NLMBde': {lat: 2096.0, lng: 1696.0, command: '1.NLMD', sidc: 'SFGPUCIZ---H', color: 'rgb(247,148,30)'}, '11.PzGBde': {lat: 752.0, lng: 3560.0, command: '4.PzGD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '11.PzGD': {lat: 2568.0, lng: 2340.0, command: 'I.Korps', sidc: 'SFGPUCIZ---I', color: 'rgb(167,169,172)'}, '12.AB(UK)': {lat: 2192.0, lng: 2280.0, command: '1.ARM(UK)', sidc: 'SFGPUCA----H', color: 'rgb(255,204,205)'}, '12.GTD': {lat: 2472.0, lng: 3592.0, command: '3.CAA', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '12.NLMBde': {lat: 2240.0, lng: 1656.0, command: '1.NLMD', sidc: 'SFGPUCIZ---H', color: 'rgb(247,148,30)'}, '12.PzBde': {lat: 984.0, lng: 3332.0, command: '4.PzGD', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '12.PzDv': {lat: 1148.0, lng: 2788.0, command: 'III.Korps', sidc: 'SFGPUCA----I', color: 'rgb(167,169,172)'}, '13.NLABde': {lat: 1864.0, lng: 1528.0, command: '1.NLMD', sidc: 'SFGPUCA----H', color: 'rgb(247,148,30)'}, '13.PzGBde': {lat: 1460.0, lng: 2436.0, command: '5.PzDv', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '14.GMRD': {lat: 2076.0, lng: 3664.0, command: '20.GCAA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '14.PzBde': {lat: 1888.0, lng: 2796.0, command: '12.PzDv', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '15.GTR': {lat: 1576.0, lng: 3028.0, command: '39.GMRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '15.PzBde': {lat: 1368.0, lng: 2160.0, command: '5.PzDv', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '16.Div(BEL)': {lat: 1844.0, lng: 2256.0, command: 'I.Corps(BEL)', sidc: 'SFGPUCIZ---I', color: 'rgb(255,255,0)'}, '16.GMRR': {lat: 2408.0, lng: 3924.0, command: '6.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '16.GTD': {lat: 2684.0, lng: 3680.0, command: '2.GTA', sidc: 'SFGPUCA----I', color: 'rgb(190,30,45)'}, '16.GTR': {lat: 2332.0, lng: 3352.0, command: '207.MRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '17.ABde(BEL)': {lat: 1596.0, lng: 2272.0, command: '16.Div(BEL)', sidc: 'SFGPUCA----H', color: 'rgb(255,255,0)'}, '17.GTR': {lat: 1500.0, lng: 3200.0, command: '79.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '17.IGRB': {lat: 2672.0, lng: 3660.0, command: '16.GTD', sidc: 'SFGPUCRVA--F', color: 'rgb(190,30,45)'}, '19.PzGBde': {lat: 1964.0, lng: 2232.0, command: '7.PzDv', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '20.AB(UK)': {lat: 2052.0, lng: 2508.0, command: '4.ARM(UK)', sidc: 'SFGPUCA----H', color: 'rgb(255,204,205)'}, '20.GCAA': {lat: 2436.0, lng: 3864.0, command: 'GSFG', sidc: 'SFGPUCIZ---J', color: 'rgb(190,30,45)'}, '20.GMRD': {lat: 1736.0, lng: 3576.0, command: '1.GTA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '20.PzBde': {lat: 1816.0, lng: 2176.0, command: '7.PzDv', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '21.MRD': {lat: 2540.0, lng: 3332.0, command: '2.GTA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '21.PzBde': {lat: 2040.0, lng: 2464.0, command: '7.PzDv', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '22.AB(UK)': {lat: 2332.0, lng: 2924.0, command: '1.ARM(UK)', sidc: 'SFGPUCA----H', color: 'rgb(255,204,205)'}, '22.PzGBde': {lat: 372.0, lng: 3048.0, command: '1.GJD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '23.TR': {lat: 1796.0, lng: 3740.0, command: '9.TD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '24.PzBde': {lat: 592.0, lng: 3412.0, command: '1.GJD', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '25.LLBde': {lat: 1768.0, lng: 2684.0, command: 'III.Korps', sidc: 'SFGPUCIA---H', color: 'rgb(167,169,172)'}, '25.TD': {lat: 2532.0, lng: 3744.0, command: '20.GCAA', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '26.LLBde': {lat: 1768.0, lng: 2684.0, command: 'III.Korps', sidc: 'SFGPUCIA---H', color: 'rgb(167,169,172)'}, '26.TR': {lat: 2192.0, lng: 3228.0, command: '47.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '27.GMRD': {lat: 1852.0, lng: 3364.0, command: '8.GCAA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '27.LLBde': {lat: 1768.0, lng: 2684.0, command: 'III.Korps', sidc: 'SFGPUCIA---H', color: 'rgb(167,169,172)'}, '28.GTR': {lat: 1876.0, lng: 3356.0, command: '27.GMRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '28.PzBde': {lat: 564.0, lng: 2804.0, command: '10.PzD', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '29.GMRR': {lat: 1436.0, lng: 3396.0, command: '20.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '29.PzBde': {lat: 400.0, lng: 2604.0, command: '10.PzD', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '30.AB(UK)': {lat: 1956.0, lng: 2480.0, command: '4.ARM(UK)', sidc: 'SFGPUCA----H', color: 'rgb(255,204,205)'}, '30.PzGBde': {lat: 352.0, lng: 2804.0, command: '10.PzD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '31.PzGBde': {lat: 2552.0, lng: 2340.0, command: '11.PzGD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '32.PzGBde': {lat: 2608.0, lng: 2432.0, command: '11.PzGD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '33.MRR': {lat: 2336.0, lng: 3328.0, command: '207.MRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '33.PzGBde': {lat: 2340.0, lng: 2840.0, command: '11.PzGD', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '33.TR': {lat: 2688.0, lng: 3328.0, command: '21.MRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '34.PzBde': {lat: 1768.0, lng: 2684.0, command: '2.PzGD', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '35.MRD': {lat: 2308.0, lng: 3660.0, command: '20.GCAA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '35.PzGBde': {lat: 1888.0, lng: 2804.0, command: '12.PzDv', sidc: 'SFGPUCIZ---H', color: 'rgb(167,169,172)'}, '36.PzBde': {lat: 1000.0, lng: 2756.0, command: '12.PzDv', sidc: 'SFGPUCA----H', color: 'rgb(167,169,172)'}, '39.GMRD': {lat: 1580.0, lng: 3028.0, command: '8.GCAA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '40.GTR': {lat: 1784.0, lng: 3900.0, command: '11.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '40.MRR': {lat: 1984.0, lng: 3304.0, command: '7.GTD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '41.MRR': {lat: 2304.0, lng: 3204.0, command: '207.MRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '41.NLABde': {lat: 2372, lng: 1880, command: '4.NLMD', sidc: 'SFGPUCA----H', color: 'rgb(247,148,30)'}, '42.NLMBde': {lat: 2504.0, lng: 1868.0, command: '4.NLMD', sidc: 'SFGPUCIZ---H', color: 'rgb(247,148,30)'}, '43.NLMBde': {lat: 2420.0, lng: 1752.0, command: '4.NLMD', sidc: 'SFGPUCIZ---H', color: 'rgb(247,148,30)'}, '44.GTR': {lat: 1784.0, lng: 3900.0, command: '11.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '45.GTR': {lat: 1652.0, lng: 3180.0, command: '79.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '47.GTD': {lat: 2204.0, lng: 3236.0, command: '3.CAA', sidc: 'SFGPUCA----I', color: 'rgb(190,30,45)'}, '47.GTR': {lat: 2656.0, lng: 3680.0, command: '16.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '48.GTR': {lat: 2468.0, lng: 3584.0, command: '12.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '51.GTR': {lat: 1668.0, lng: 3404.0, command: '57.GMRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '54.GAR': {lat: 1868.0, lng: 3376.0, command: '27.GMRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '55.GTR': {lat: 1992.0, lng: 3420.0, command: '7.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '56.GTR': {lat: 2060.0, lng: 3392.0, command: '7.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '57.GMRD': {lat: 1712.0, lng: 3312.0, command: '8.GCAA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '60.MRR': {lat: 2588.0, lng: 3692.0, command: '16.GTD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '61.GTR': {lat: 2276.0, lng: 3660.0, command: '10.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '62.GTR': {lat: 2240.0, lng: 3664.0, command: '10.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '62.MRR': {lat: 2312.0, lng: 3648.0, command: '35.MRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '63.GTR': {lat: 2248.0, lng: 3652.0, command: '10.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '64.MRR': {lat: 2308.0, lng: 3640.0, command: '35.MRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '65.GTR': {lat: 2660.0, lng: 3660.0, command: '16.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '67.GMRR': {lat: 1740.0, lng: 3568.0, command: '20.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '67.GTR': {lat: 2336.0, lng: 3460.0, command: '16.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '68.GMRR': {lat: 1840.0, lng: 3352.0, command: '27.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '68.GTR': {lat: 2364.0, lng: 3804.0, command: '6.GMRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '69.MRR': {lat: 2156.0, lng: 3776.0, command: '14.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '70.GTR': {lat: 1828.0, lng: 3744.0, command: '9.TD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '74.GTR': {lat: 2788.0, lng: 3236.0, command: '94.GMRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '79.GTD': {lat: 1636.0, lng: 3268.0, command: '8.GCAA', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '79.GTR': {lat: 2032.0, lng: 3440.0, command: '7.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '81.GMRR': {lat: 2432.0, lng: 3880.0, command: '6.GMRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '83.GMRR': {lat: 2312.0, lng: 3648.0, command: '35.MRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '87.GAR': {lat: 1624.0, lng: 3000.0, command: '39.GMRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '94.GMRD': {lat: 2808.0, lng: 3196.0, command: '2.GTA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '95.TR': {lat: 1808.0, lng: 3724.0, command: '9.TD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '96.AR': {lat: 1704.0, lng: 3508.0, command: '9.TD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '99.AR': {lat: 2140.0, lng: 3284.0, command: '47.GTD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '117.GAR': {lat: 2244.0, lng: 3312.0, command: '12.GTD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '117.GMRR': {lat: 1476.0, lng: 2936.0, command: '39.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '120.GMRR': {lat: 1624.0, lng: 3004.0, command: '39.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '128.GAR': {lat: 1664.0, lng: 3404.0, command: '57.GMRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '153.TR': {lat: 2208.0, lng: 3224.0, command: '47.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '162.TR': {lat: 2532.0, lng: 3752.0, command: '25.TD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '170.GMRR': {lat: 1708.0, lng: 3312.0, command: '57.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '172.GAR': {lat: 1524.0, lng: 3180.0, command: '79.GTD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '174.GMRR': {lat: 1736.0, lng: 3368.0, command: '57.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '175.TR': {lat: 2636.0, lng: 3872.0, command: '25.TD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '197.TR': {lat: 2032.0, lng: 3108.0, command: '47.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '199.GAR': {lat: 2912.0, lng: 3232.0, command: '94.GMRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '200.GMRR': {lat: 2716.0, lng: 3736.0, command: '12.GTD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '204.GMRR': {lat: 1436.0, lng: 3396.0, command: '94.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '207.MRD': {lat: 2352.0, lng: 3320.0, command: '2.GTA', sidc: 'SFGPUCIZ---I', color: 'rgb(190,30,45)'}, '211.TR': {lat: 1632.0, lng: 3268.0, command: '79.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '215.GMRR': {lat: 2372.0, lng: 3804.0, command: '6.GMRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '216.GMRR': {lat: 2076.0, lng: 3652.0, command: '14.GMRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '219.TR': {lat: 2304.0, lng: 3648.0, command: '20.GMRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '223.GMRR': {lat: 2084.0, lng: 3644.0, command: '14.GMRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '239.GMRR': {lat: 2536.0, lng: 3328.0, command: '21.MRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '240.GMRR': {lat: 2648.0, lng: 3232.0, command: '21.MRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '241.GMRR': {lat: 1788.0, lng: 3448.0, command: '57.GMRD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '242.GMRR': {lat: 1808.0, lng: 3576.0, command: '20.GMRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '243.GMRR': {lat: 1840.0, lng: 3364.0, command: '27.GMRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '244.GMRR': {lat: 1752.0, lng: 3000.0, command: '27.GMRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '245.GMRR': {lat: 2136.0, lng: 3252.0, command: '207.MRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '246.GMRR': {lat: 2132.0, lng: 3280.0, command: '47.GTD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '247.GMRR': {lat: 1652.0, lng: 3176.0, command: '79.GTD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '248.MRR': {lat: 2276.0, lng: 3668.0, command: '10.GTD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '249.MRR': {lat: 1696.0, lng: 3856.0, command: '11.GTD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '283.GAR': {lat: 2304.0, lng: 3652.0, command: '35.MRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '283.GMRR': {lat: 2688.0, lng: 3148.0, command: '21.MRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '286.GMRR': {lat: 2788.0, lng: 3184.0, command: '94.GMRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '288.GMRR': {lat: 2880.0, lng: 3212.0, command: '94.GMRD', sidc: 'SFGPUCIM---G', color: 'rgb(190,30,45)'}, '302.MRR': {lat: 1780.0, lng: 3720.0, command: '9.TD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '332.GTR': {lat: 2484.0, lng: 3592.0, command: '12.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '335.GTR': {lat: 2636.0, lng: 3872.0, command: '25.TD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '343.GTR': {lat: 2080.0, lng: 3656.0, command: '14.GMRD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '353.GTR': {lat: 2464.0, lng: 3588.0, command: '12.GTD', sidc: 'SFGPUCA----G', color: 'rgb(190,30,45)'}, '400.AR': {lat: 2228.0, lng: 4064.0, command: '6.GMRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '469.GAR': {lat: 2084.0, lng: 3648.0, command: '14.GMRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '670.GAR': {lat: 1996.0, lng: 3428.0, command: '7.GTD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '693.AR': {lat: 2348.0, lng: 3328.0, command: '207.MRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '724.GAR': {lat: 2660.0, lng: 3668.0, command: '16.GTD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '744.AR': {lat: 2256.0, lng: 3656.0, command: '10.GTD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '803.GMRR': {lat: 2572.0, lng: 3688.0, command: '25.TD', sidc: 'SFGPUCIZ---G', color: 'rgb(190,30,45)'}, '841.GAR': {lat: 1576.0, lng: 3624.0, command: '11.GTD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '843.GAR': {lat: 2528.0, lng: 3748.0, command: '25.TD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '944.GAR': {lat: 1716.0, lng: 3628.0, command: '20.GMRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, '1054.AR': {lat: 2336.0, lng: 3464.0, command: '21.MRD', sidc: 'SFGPUCFHE--G', color: 'rgb(190,30,45)'}, 'GSFG': {lat: 4000, lng: 0, command: '', sidc: 'SFGP--------', color: 'rgb(190,30,45)'}, 'I.Corps(BEL)': {lat: 1620.0, lng: 1952.0, command: 'SACEUR', sidc: 'SFGPU------J', color: 'rgb(255,255,0)'}, 'I.Corps(NL)': {lat: 2172.0, lng: 1704.0, command: 'SACEUR', sidc: 'SFGPU------J', color: 'rgb(247,148,30)'}, 'I.Corps(UK)': {lat: 2084.0, lng: 2416.0, command: 'SACEUR', sidc: 'SFGPU------J', color: 'rgb(255,204,205)'}, 'I.Korps': {lat: 2060.0, lng: 2164.0, command: 'SACEUR', sidc: 'SFGPU------J', color: 'rgb(167,169,172)'}, 'II.Korps': {lat: 524.0, lng: 2804.0, command: 'SACEUR', sidc: 'SFGPU------J', color: 'rgb(167,169,172)'}, 'III.Korps': {lat: 1380.0, lng: 2144.0, command: 'SACEUR', sidc: 'SFGPU------J', color: 'rgb(167,169,172)'}, 'LaSK': {lat: 4000, lng: 0, command: '', sidc: 'SFGP--------', color: 'rgb(153,69,70)'}, 'MB.III': {lat: 1796.0, lng: 3472.0, command: 'LaSK', sidc: 'SFGPU------K', color: 'rgb(153,69,70)'}, 'MB.V': {lat: 2752.0, lng: 3728.0, command: 'LaSK', sidc: 'SFGPU------K', color: 'rgb(153,69,70)'}, 'MSR.1': {lat: 2400.0, lng: 3712.0, command: '1.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.2': {lat: 2244.0, lng: 3704.0, command: '1.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.3': {lat: 2264.0, lng: 3516.0, command: '1.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.7': {lat: 2952.0, lng: 5312.0, command: '7.PzD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.9': {lat: 1732.0, lng: 2944.0, command: '9.PzD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.16': {lat: 1804.0, lng: 3124.0, command: '11.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.17': {lat: 1468.0, lng: 3492.0, command: '11.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.18': {lat: 1024.0, lng: 3244.0, command: '11.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.22': {lat: 1732.0, lng: 2944.0, command: '4.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.23': {lat: 1568.0, lng: 2876.0, command: '4.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.24': {lat: 1652.0, lng: 3088.0, command: '4.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.27': {lat: 2824.0, lng: 3196.0, command: '8.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.28': {lat: 2976.0, lng: 3400.0, command: '8.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'MSR.29': {lat: 3124.0, lng: 3804.0, command: '8.MSD', sidc: 'SFGPUCIZ---G', color: 'rgb(153,69,70)'}, 'PzR.1': {lat: 2180.0, lng: 3640.0, command: '1.MSD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'PzR.4': {lat: 1628.0, lng: 3016.0, command: '4.MSD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'PzR.8': {lat: 2760.0, lng: 3396.0, command: '8.MSD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'PzR.11': {lat: 1808.0, lng: 3056.0, command: '11.MSD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'PzR.14': {lat: 1896.0, lng: 4024.0, command: '7.PzD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'PzR.15': {lat: 1976.0, lng: 4016.0, command: '7.PzD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'PzR.16': {lat: 1776.0, lng: 3792.0, command: '7.PzD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'PzR.21': {lat: 2780.0, lng: 3924.0, command: '9.PzD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'PzR.22': {lat: 2784.0, lng: 3936.0, command: '9.PzD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'PzR.23': {lat: 2772.0, lng: 3940.0, command: '9.PzD', sidc: 'SFGPUCA----G', color: 'rgb(153,69,70)'}, 'SACEUR': {lat: 4000, lng: 0, command: '', sidc: 'SFGP--------', color: 'rgb(167,169,172)'}, 'V.Corps(US)': {lat: 1268.0, lng: 2456.0, command: 'SACEUR', sidc: 'SFGPU------J', color: 'rgb(0,174,239)'}, 'VII.Corps(US)': {lat: 696.0, lng: 2592.0, command: 'SACEUR', sidc: 'SFGPU------J', color: 'rgb(0,174,239)'}}
var map;

		
function getSubUnits(command,level,point,distance){
	var units = []
	for (var id in orbat){
		if(orbat[id].command == command){
			var distanceToCommand = false;
			if(command != ""){
				distanceToCommand = Math.sqrt(Math.pow((orbat[command].lat-orbat[id].lat),2)+Math.pow((orbat[command].lng-orbat[id].lng),2))
				orbat[command].distance = Math.max(orbat[command].distance,distanceToCommand)
			}
			//for(var i = 0; i<level; i++){unitstring += "- "}

			subunits =  getSubUnits(id, level+1, [orbat[id].lat, orbat[id].lng],(orbat[id].distance < distance)?0:distance)
			if(orbat[id].distance < distance){
				orbat[id].marker.addTo(map)
			}else{
				map.removeLayer(orbat[id].marker)
			}
			//We are now manipulating the visibility so no extra units will be visible
			orbat[id].subUnitsVisible = false;
			orbat[id].commandVisible = false;
			
			//unitstring += (orbat[id].distance < distance)?"<b>":"" //Display unit
			//unitstring += id + " DC: "+ distanceToCommand + " DS: " + orbat[id].distance+ "<"+distance+"\n"
			//unitstring += (orbat[id].distance < distance)?"</b>":"" //Display unit
			units.push({id:id,level:level})
			units = units.concat(subunits.orbat);
		}
	}
	return {orbat:units};
}

function updateOrbat(){
pixeldistance = 100;
//alert(Math.abs(map.options.crs.pointToLatLng(L.point(pixeldistance, 0),map.getZoom()).lng - map.options.crs.pointToLatLng(L.point(0, 0),map.getZoom()).lng))
getSubUnits('',0,[null,null],Math.abs(map.options.crs.pointToLatLng(L.point(pixeldistance, 0),map.getZoom()).lng - map.options.crs.pointToLatLng(L.point(0, 0),map.getZoom()).lng))
//alert(getSubUnits('',0,[null,null],Math.abs(map.options.crs.pointToLatLng(L.point(pixeldistance, 0),map.getZoom()).lng - map.options.crs.pointToLatLng(L.point(0, 0),map.getZoom()).lng)).string)

}

function unitMoved(e){
	orbat[this.id].lat = this.getLatLng().lat
	orbat[this.id].lng = this.getLatLng().lng
	//alert(this.id)
	//Reset all distances
	for (var id in orbat){
		orbat[id].distance = 0;
	}
	//calulate new distances
	updateOrbat()
	//make sure visibility is correct
	updateOrbat()
}

function showhideSubUnits(e){
	for (var id in orbat){
		if(orbat[id].command == this.id){
			if(!orbat[this.id].subUnitsVisible){
				orbat[id].marker.addTo(map)
			}else{
				map.removeLayer(orbat[id].marker)
			}
		}
	}
	orbat[this.id].subUnitsVisible = !orbat[this.id].subUnitsVisible
}


function showhideCommandUnit(e){
	for (var id in orbat){
		if(id == orbat[this.id].command){	
			if(!orbat[this.id].commandVisible){
				orbat[id].marker.addTo(map)
			}else{
				map.removeLayer(orbat[id].marker)
			}
		}
	}
	orbat[this.id].commandVisible = !orbat[this.id].commandVisible
}

function init(){
		
var cloudmadeUrl = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png',
		cloudmadeAttribution = '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
		cloudmade = L.tileLayer(cloudmadeUrl, {maxZoom: 18, attribution: cloudmadeAttribution}),
		latlng = L.latLng(966*2,1348*2), imagelayer = L.imageOverlay('./map.svg',[[0,0],[966*4,1348*4]]);
		
	map = L.map('map', {crs: L.CRS.Simple, center: latlng, zoom: -2, layers: [imagelayer], minZoom: -5});
	


	var mysymbol = [];
	var myicon = [];
	var mymarker =[];
	
	UnitMarker = L.Marker.extend({
   		options: { 
			id: ''
  		}
	});

	for (var key in orbat){
		orbat[key].distance = 0;
		orbat[key].subUnitsVisible  = false;
		orbat[key].commandVisible  = false;
		
		var color = ms.ColorMode(orbat[key].color,orbat[key].color,orbat[key].color,orbat[key].color,orbat[key].color)
		
		iconSize = {"D":10,"E":15,"F":20,"G":25,"H":30,"I":35,"J":40,"K":40,"-":30};

		mysymbol[key] = new ms.Symbol(orbat[key].sidc,{size:iconSize[(orbat[key].sidc).charAt(11)],uniqueDesignation:key,higherFormation:orbat[key].command,colorMode:color})
		// console.log(key + ' | ' + orbat[key].sidc.charAt(11) + ' | ' +iconSize[(orbat[key].sidc).charAt(11)])
		var size = mysymbol[key].getSize()
		myicon[key] = L.divIcon({	className: 'test', 
							html : mysymbol[key].asSVG(), 
							iconAnchor: new L.Point(size.width/2, size.height/2)});
		
		
		orbat[key].marker = L.marker([orbat[key].lat, orbat[key].lng],{icon:myicon[key], draggable:false, id:key}); 
		orbat[key].marker.on('dragend', unitMoved);
		orbat[key].marker.on('click', showhideSubUnits);
		orbat[key].marker.on('contextmenu', showhideCommandUnit);
		orbat[key].marker.id = key;
	
		//orbat[key].marker.addTo(map)
	}
	units = getSubUnits('',0,[null,null],10)
	

	// for(var id in units.orbat){ 
	//	 document.getElementById("orbat").innerHTML += '<div style="padding-left:'+(10*units.orbat[id].level)+'px">'+mysymbol[units.orbat[id].id].textXML+'</div>'; -->
	// }
	
	map.on('zoomend', updateOrbat);
	// document.getElementById("loader").style.display = "none";
	
	updateOrbat()
}
</script>
</head>
<body onload="init()">
<div style="width: 100%; height: 90; display: flex; overflow: hidden;">
	<div id="map" style="padding:20px; height:90vh; width: 70%;"></div>
	<div style="overflow:auto;height:90vh;width:15%;">
		<div id="situation"></div>
	</div>
	<div style="overflow:auto;height:90vh;width:15%">
		<div id="equip" style="flex-grow: 1; padding:25px;"></div>
	</div>
</div>
<!-- <div id="orbat">ORBAT</div> -->
<script>
    var duration = 300;
    var margin = { top: 15, right: 20, bottom: 10, left: 30 };
    var svg = d3.select("#situation")
      .append("svg")
      .attr("width", 250)
      .attr("height", 500)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	
	
    function geoJson2tree(data, name, command) {
      var rawdata = {};
      for (var key in data.features) {
        rawdata[data.features[key].properties[name]] = data.features[key];
        rawdata[data.features[key].properties[name]].suborgs = [];
        data.features[key].name = data.features[key].properties[name].replace('&#228;', 'ä').replace('&#229;', 'å');
        data.features[key].sidc = data.features[key].properties["SIDC"];
		data.features[key].eqp  = data.features[key].properties["equipment"]
		// console.log(data.features[key].eqp)
		data.features[key].color = data.features[key].properties["color"]
      }
      // var tree = { "name": "", "sidc": "SFGP------", "suborgs": [] };
      var tree = { "name": "ALL COMMAND", "sidc": "SFGP------", "suborgs": [] };
      for (var key in rawdata) {
        if (rawdata.hasOwnProperty(rawdata[key].properties[command])) {
          rawdata[rawdata[key].properties[command]].suborgs.push(rawdata[key]);
        } else {
          var newCommand = { "name": rawdata[key].properties[command], "sidc": "SFGP------", "suborgs": [rawdata[key]], color: rawdata[key].properties["color"] };
          rawdata[rawdata[key].properties[command]] = newCommand;
          tree.suborgs.push(newCommand);
        }
      }
      return tree;
    }
    var structure = geoJson2tree(situation, "name", "command");

    var d3cluster = d3.tree().nodeSize([0, 20]);;
    var d3hirarcy = d3.hierarchy(structure, function (d) { return d.suborgs; });
    d3hirarcy.x0 = 0;
    d3hirarcy.y0 = 0;

    update(svg, d3cluster, d3hirarcy, d3hirarcy);
	
	
    function update(svg, d3cluster, d3hirarcy, source) {
      var barHeight = 25;
      // Compute the new tree layout.
      var nodes = d3cluster(d3hirarcy),
        links = nodes.links();

      var height = Math.max(500, nodes.descendants().length * barHeight + margin.top + margin.bottom);

      d3.select("#situation").select("svg").transition()
        .duration(duration)
        .attr("height", height);
        //.attr("height", 800);

      // Compute the "layout".
      var i = 0;
      nodes.eachBefore(function (d) {
        //console.log('d.x0 '+d.x0 +' === d.x ' + ((i++) * barHeight) + '  === d.name ' + d.data.name)
        d.x = (i++) * barHeight;
      });

      //update existing
      var node = svg.selectAll("g.node")
        .data(d3hirarcy.descendants(), function (d) { return d.id || (d.id = ++i); });

      node.transition()
        .duration(duration)
        .attr("transform", function (d) { return "translate(" + (d.y) + "," + (d.x) + ")"; });

      node.select(".indicator").transition()
        .duration(duration)
        .attr("fill", function (d) { if (d._children) { return "rgb(250,250,250)" } else { return "rgb(100,100,100)" } })
        .attr("transform", function (d) { if (d._children) { return "translate(-21,0) rotate(0)" } else { return "translate(-21,0) rotate(45)" } })
      //Enter new nodes
      var newNode = node.enter().append("g")
        .attr("class", "node")
        .attr("transform", function (d) { return "translate(" + (source.y0) + "," + (source.x0) + ")"; })
        .style("opacity", 1e-6);

      newNode.transition()
        .duration(duration)
        .attr("transform", function (d) { return "translate(" + (d.y) + "," + (d.x) + ")"; })
        .style("opacity", 1);

      newNode.each(function (d) {
        if (d.children || d._children) {
          d3.select(this)
            .append("path")
            .attr("class", "indicator")
            .attr("d", "M -0,-5 l 5,5 -5,5 z")
            .attr("fill", function (d) { if (d._children) { return "rgb(250,250,250)" } else { return "rgb(100,100,100)" } })
            .attr("transform", function (d) { if (d._children) { return "translate(-21,0) rotate(0)" } else { return "translate(-21,0) rotate(45)" } })
            .on("click", function click(d) {
              if (d.children) {
                d._children = d.children;
                d.children = null;
              } else {
                d.children = d._children;
                d._children = null;
              }
              update(svg, d3cluster, d3hirarcy, d);
            });
        }
      })

      //milsymbol icon    
      newNode.append("g")
        .attr("class", "symbol")
        .attr("transform", function (d) {
          if (d.data.sidc) d.data.symbol = new ms.Symbol(d.data.sidc, { size: 15, colorMode: ms.ColorMode(d.data.color,d.data.color,d.data.color,d.data.color,d.data.color)});
          return "translate(" + (-d.data.symbol.getOctagonAnchor().x) + "," + (-d.data.symbol.getOctagonAnchor().y) + ")";
        })
        .each(function (d) { this.appendChild(d.data.symbol.asDOM()) }).on("click", function nodeClick(d) {
																		//console.log(d.data.eqp)
																		// actually set equip div data to equipment
																		document.getElementById("equip").innerHTML = d.data.eqp
																		console.log(d.data.symbol.getProperties().echelon)
																	});
	  
      newNode.append("text")
        .attr("class", "node-text")
        .attr("dy", 3)
        .attr("x", 20)
        .style("text-anchor", "start")
        .text(function (d) { return d.data.name; });

      //Remove old nodes
      node.exit()
        .transition()
        .duration(duration)
        .attr("transform", function (d) {
          return "translate(" + source.y + "," + source.x + ")";
        })
        .style("opacity", 1e-6)
        .remove();

      //Link code
      var link = svg.selectAll("path.link")
        .data(d3hirarcy.descendants().slice(1), function (link) { return link.id + ':' + link.parent.id; });

      // Transition links to their new position.
      link.transition()
        .duration(duration)
        .attr("d", function (d) {
          return "M" + d.parent.y + "," + d.parent.x
            + " l"
            + " 0," + (d.x - d.parent.x) + " "
            + (d.y - d.parent.y) / 2 + "," + 0 + " "
            + "L" + d.y + "," + d.x;
        });

      var newLink = link.enter()
        .insert("path", "g")
        .attr("class", "link")
        .attr("d", function (d) {
          return "M" + source.y0 + "," + source.x0
            + " l"
            + " 0," + (source.x0 - source.x0) + " "
            + (source.y0 - source.y0) / 2 + "," + 0 + " "
            + "L" + source.y0 + "," + source.x0;
        });

      newLink.transition()
        .duration(duration)
        .attr("d", function (d) {
          return "M" + d.parent.y + "," + d.parent.x
            + " l"
            + " 0," + (d.x - d.parent.x) + " "
            + (d.y - d.parent.y) / 2 + "," + 0 + " "
            + "L" + d.y + "," + d.x;
        });

      // Transition exiting nodes to the parent's new position.
      link.exit().transition()
        .duration(duration)
        .attr("d", function (d) {
          return "M" + source.y0 + "," + source.x0
            + " l"
            + " 0," + (source.x0 - source.x0) + " "
            + (source.y0 - source.y0) / 2 + "," + 0 + " "
            + "L" + source.y0 + "," + source.x0;
        })
        .remove();

      // if click
      // Old positions for transition.
      nodes.each(function (d) {
        d.x0 = d.x;
        d.y0 = d.y;
      });

    }

</script>


</body>
</html>